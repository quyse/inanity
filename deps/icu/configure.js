/* configure for building icu
 */

exports.configureCompiler = function(objectFile, compiler) {
	// object files: <conf>/object
	var a = /^([^\/]+)\/([^\/]+)$/.exec(objectFile);
	compiler.configuration = a[1];
	var source = a[2];
	var b = /^(.*)\.c$/.exec(source);
	if(b) {
		// .c-файл
		source = b[1].replace(/\./g, '/') + '.c';
		compiler.cppMode = false;
	}
	else
		// .cpp-файл
		source = source.replace(/\./g, '/') + '.cpp';
	compiler.setSourceFile('repo/source/' + source);
	compiler.addIncludeDir('repo/source/common');
	compiler.addIncludeDir('repo/source/i18n');
	compiler.addMacro('U_STATIC_IMPLEMENTATION');
	compiler.addMacro('U_ENABLE_DYLOAD=0');
	compiler.addMacro('UCONFIG_NO_FILE_IO=1');
	// crazy hacks for windows
	compiler.addMacro('__WINTZ'); // to skip including wintz.h
	compiler.addMacro('uprv_detectWindowsTimeZone=__noop');
	// crazy hacks for xbox
	if(compiler.platform == 'xbox') {
		compiler.addMacro('U_TZSET=__noop');
		compiler.addMacro('getenv=""+__noop');
		compiler.addMacro('GetACP=65001+__noop');
	}
	// crazy hack for switch
	if(compiler.platform == 'switch') {
		compiler.addMacro('register=');
	}

	var c = /^([^\/]*)\//.exec(source);
	switch(c[1]) {
	case 'common':
		compiler.addMacro('U_COMMON_IMPLEMENTATION');
		break;
	case 'i18n':
		compiler.addMacro('U_I18N_IMPLEMENTATION');
		break;
	}
	compiler.strict = false;
};

var objects = [
	'common.appendable',
	'common.bmpset',
	'common.brkeng',
	'common.brkiter',
	'common.bytestream',
	'common.bytestrie',
	'common.bytestriebuilder',
	'common.bytestrieiterator',
	'common.caniter',
	'common.chariter',
	'common.charstr',
	'common.cmemory',
	'common.cstr',
	'common.cstring',
	'common.cwchar',
	'common.dictbe',
	'common.dictionarydata',
	'common.dtintrv',
	'common.edits',
	'common.errorcode',
	'common.filteredbrk',
	'common.filterednormalizer2',
	'common.icudataver',
	'common.icuplug',
	'common.listformatter',
	'common.loadednormalizer2impl',
	'common.locavailable',
	'common.locbased',
	'common.locdispnames',
	'common.locdspnm',
	'common.locid',
	'common.loclikely',
	'common.locmap',
	'common.locresdata',
	'common.locutil',
	'common.messagepattern',
	'common.normalizer2',
	'common.normalizer2impl',
	'common.normlzr',
	'common.parsepos',
	'common.patternprops',
	'common.pluralmap',
	'common.propname',
	'common.propsvec',
	'common.punycode',
	'common.putil',
	'common.rbbi',
	'common.rbbidata',
	'common.rbbinode',
	'common.rbbirb',
	'common.rbbiscan',
	'common.rbbisetb',
	'common.rbbistbl',
	'common.rbbitblb',
	'common.resbund',
	'common.resbund_cnv',
	'common.resource',
	'common.ruleiter',
	'common.schriter',
	'common.serv',
	'common.servlk',
	'common.servlkf',
	'common.servls',
	'common.servnotf',
	'common.servrbf',
	'common.servslkf',
	'common.sharedobject',
	'common.simpleformatter',
	'common.stringpiece',
	'common.stringtriebuilder',
	'common.uarrsort',
	'common.ubidi',
	'common.ubidi_props',
	'common.ubidiln',
	'common.ubiditransform',
	'common.ubidiwrt',
	'common.ubrk',
	'common.ucase',
	'common.ucasemap',
	'common.ucasemap_titlecase_brkiter',
	'common.ucat',
	'common.uchar',
	'common.ucharstrie',
	'common.ucharstriebuilder',
	'common.ucharstrieiterator',
	'common.uchriter',
	'common.ucln_cmn',
	'common.ucmndata',
	'common.ucnv',
	'common.ucnv2022',
	'common.ucnv_bld',
	'common.ucnv_cb',
	'common.ucnv_cnv',
	'common.ucnv_ct',
	'common.ucnv_err',
	'common.ucnv_ext',
	'common.ucnv_io',
	'common.ucnv_lmb',
	'common.ucnv_set',
	'common.ucnv_u16',
	'common.ucnv_u32',
	'common.ucnv_u7',
	'common.ucnv_u8',
	'common.ucnvbocu',
	'common.ucnvdisp',
	'common.ucnvhz',
	'common.ucnvisci',
	'common.ucnvlat1',
	'common.ucnvmbcs',
	'common.ucnvscsu',
	'common.ucnvsel',
	'common.ucol_swp',
	'common.ucurr',
	'common.udata',
	'common.udatamem',
	'common.udataswp',
	'common.uenum',
	'common.uhash',
	'common.uhash_us',
	'common.uidna',
	'common.uinit',
	'common.uinvchar',
	'common.uiter',
	'common.ulist',
	'common.ulistformatter',
	'common.uloc',
	'common.uloc_keytype',
	'common.uloc_tag',
	'common.umapfile',
	'common.umath',
	'common.umutex',
	'common.unames',
	'common.unifiedcache',
	'common.unifilt',
	'common.unifunct',
	'common.uniset',
	'common.uniset_closure',
	'common.uniset_props',
	'common.unisetspan',
	'common.unistr',
	'common.unistr_case',
	'common.unistr_case_locale',
	'common.unistr_cnv',
	'common.unistr_props',
	'common.unistr_titlecase_brkiter',
	'common.unorm',
	'common.unormcmp',
	'common.uobject',
	'common.uprops',
	'common.ures_cnv',
	'common.uresbund',
	'common.uresdata',
	'common.usc_impl',
	'common.uscript',
	'common.uscript_props',
	'common.uset',
	'common.uset_props',
	'common.usetiter',
	'common.ushape',
	'common.usprep',
	'common.ustack',
	'common.ustr_cnv',
	'common.ustr_titlecase_brkiter',
	'common.ustr_wcs',
	'common.ustrcase',
	'common.ustrcase_locale',
	'common.ustrenum',
	'common.ustrfmt',
	'common.ustring',
	'common.ustrtrns',
	'common.utext',
	'common.utf_impl',
	'common.util',
	'common.util_props',
	'common.utrace',
	'common.utrie',
	'common.utrie2',
	'common.utrie2_builder',
	'common.uts46',
	'common.utypes',
	'common.uvector',
	'common.uvectr32',
	'common.uvectr64',
	// 'common.wintz',

// not used
/*
	'i18n.affixpatternparser',
	'i18n.alphaindex',
	'i18n.anytrans',
	'i18n.astro',
	'i18n.basictz',
	'i18n.bocsu',
	'i18n.brktrans',
	'i18n.buddhcal',
	'i18n.calendar',
	'i18n.casetrn',
	'i18n.cecal',
	'i18n.chnsecal',
	'i18n.choicfmt',
	'i18n.coleitr',
	'i18n.coll',
	'i18n.collation',
	'i18n.collationbuilder',
	'i18n.collationcompare',
	'i18n.collationdata',
	'i18n.collationdatabuilder',
	'i18n.collationdatareader',
	'i18n.collationdatawriter',
	'i18n.collationfastlatin',
	'i18n.collationfastlatinbuilder',
	'i18n.collationfcd',
	'i18n.collationiterator',
	'i18n.collationkeys',
	'i18n.collationroot',
	'i18n.collationrootelements',
	'i18n.collationruleparser',
	'i18n.collationsets',
	'i18n.collationsettings',
	'i18n.collationtailoring',
	'i18n.collationweights',
	'i18n.compactdecimalformat',
	'i18n.coptccal',
	'i18n.cpdtrans',
	'i18n.csdetect',
	'i18n.csmatch',
	'i18n.csr2022',
	'i18n.csrecog',
	'i18n.csrmbcs',
	'i18n.csrsbcs',
	'i18n.csrucode',
	'i18n.csrutf8',
	'i18n.curramt',
	'i18n.currfmt',
	'i18n.currpinf',
	'i18n.currunit',
	'i18n.dangical',
	'i18n.datefmt',
	'i18n.dayperiodrules',
	'i18n.dcfmtsym',
	'i18n.decContext',
	'i18n.decfmtst',
	'i18n.decimalformatpattern',
	'i18n.decimfmt',
	'i18n.decimfmtimpl',
	'i18n.decNumber',
	'i18n.digitaffix',
	'i18n.digitaffixesandpadding',
	'i18n.digitformatter',
	'i18n.digitgrouping',
	'i18n.digitinterval',
	'i18n.digitlst',
	'i18n.dtfmtsym',
	'i18n.dtitvfmt',
	'i18n.dtitvinf',
	'i18n.dtptngen',
	'i18n.dtrule',
	'i18n.esctrn',
	'i18n.ethpccal',
	'i18n.fmtable',
	'i18n.fmtable_cnv',
	'i18n.format',
	'i18n.fphdlimp',
	'i18n.fpositer',
	'i18n.funcrepl',
	'i18n.gender',
	'i18n.gregocal',
	'i18n.gregoimp',
	'i18n.hebrwcal',
	'i18n.indiancal',
	'i18n.inputext',
	'i18n.islamcal',
	'i18n.japancal',
	'i18n.measfmt',
	'i18n.measunit',
	'i18n.measure',
	'i18n.msgfmt',
	'i18n.name2uni',
	'i18n.nfrs',
	'i18n.nfrule',
	'i18n.nfsubs',
	'i18n.nortrans',
	'i18n.nultrans',
	'i18n.numfmt',
	'i18n.numsys',
	'i18n.olsontz',
	'i18n.persncal',
	'i18n.pluralaffix',
	'i18n.plurfmt',
	'i18n.plurrule',
	'i18n.precision',
	'i18n.quant',
	'i18n.quantityformatter',
	'i18n.rbnf',
	'i18n.rbt',
	'i18n.rbt_data',
	'i18n.rbt_pars',
	'i18n.rbt_rule',
	'i18n.rbt_set',
	'i18n.rbtz',
	'i18n.regexcmp',
	'i18n.regeximp',
	'i18n.regexst',
	'i18n.regextxt',
	'i18n.region',
	'i18n.reldatefmt',
	'i18n.reldtfmt',
	'i18n.rematch',
	'i18n.remtrans',
	'i18n.repattrn',
	'i18n.rulebasedcollator',
	'i18n.scientificnumberformatter',
	'i18n.scriptset',
	'i18n.search',
	'i18n.selfmt',
	'i18n.sharedbreakiterator',
	'i18n.simpletz',
	'i18n.smallintformatter',
	'i18n.smpdtfmt',
	'i18n.smpdtfst',
	'i18n.sortkey',
	'i18n.standardplural',
	'i18n.strmatch',
	'i18n.strrepl',
	'i18n.stsearch',
	'i18n.taiwncal',
	'i18n.timezone',
	'i18n.titletrn',
	'i18n.tmunit',
	'i18n.tmutamt',
	'i18n.tmutfmt',
	'i18n.tolowtrn',
	'i18n.toupptrn',
	'i18n.translit',
	'i18n.transreg',
	'i18n.tridpars',
	'i18n.tzfmt',
	'i18n.tzgnames',
	'i18n.tznames',
	'i18n.tznames_impl',
	'i18n.tzrule',
	'i18n.tztrans',
	'i18n.ucal',
	'i18n.ucln_in',
	'i18n.ucol',
	'i18n.ucol_res',
	'i18n.ucol_sit',
	'i18n.ucoleitr',
	'i18n.ucsdet',
	'i18n.udat',
	'i18n.udateintervalformat',
	'i18n.udatpg',
	'i18n.ufieldpositer',
	'i18n.uitercollationiterator',
	'i18n.ulocdata',
	'i18n.umsg',
	'i18n.unesctrn',
	'i18n.uni2name',
	'i18n.unum',
	'i18n.unumsys',
	'i18n.upluralrules',
	'i18n.uregex',
	'i18n.uregexc',
	'i18n.uregion',
	'i18n.usearch',
	'i18n.uspoof',
	'i18n.uspoof_build',
	'i18n.uspoof_conf',
	'i18n.uspoof_impl',
	'i18n.utf16collationiterator',
	'i18n.utf8collationiterator',
	'i18n.utmscale',
	'i18n.utrans',
	'i18n.valueformatter',
	'i18n.visibledigits',
	'i18n.vtzone',
	'i18n.vzone',
	'i18n.windtfmt',
	'i18n.winnmfmt',
	'i18n.wintzimpl',
	'i18n.zonemeta',
	'i18n.zrule',
	'i18n.ztrans',
*/

	'stubdata.stubdata',
];

exports.configureComposer = function(libraryFile, composer) {
	// library files: <conf>/library
	var a = /^(([^\/]+)\/)([^\/]+)$/.exec(libraryFile);
	var confDir = a[1];
	composer.configuration = a[2];
	for(var i = 0; i < objects.length; ++i)
		composer.addObjectFile(confDir + objects[i]);
};
